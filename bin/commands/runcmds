#!/usr/bin/env python
# Using PyPPL to distribute and run commands.
import sys
from pyppl import PyPPL, Proc
from bioprocs import params

params.prefix('-')
params.cmds.desc   = 'The cmd list. If not provided, STDIN will be used.'
params.runner      = 'local'
params.runner.desc = 'The runner.'
params.forks       = 1
params.forks.desc  = 'How many jobs to run simultaneously.'

params             = params.parse().toDict()

if params.cmds:
	with open(params.cmds, 'r') as f:
		cmds = [line.strip() for line in f.readlines() if line.strip()]
else:
	cmds = [line.strip() for line in sys.stdin if line.strip()]

pCmdRunner = Proc()
pCmdRunner.runner = params.runner
pCmdRunner.cache  = False
pCmdRunner.forks  = params.forks
pCmdRunner.input  = {'cmd': cmds}
pCmdRunner.script = '{{in.cmd}}'

PyPPL({'log':{'file':None}}).start(pCmdRunner).run()
